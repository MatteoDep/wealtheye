{{block "holdings-page" .}}
<h2>Holdings Overview</h2>
{{template "holdings-balance-section" .}}
{{template "holdings-wallets-section" .}}
{{end}}

{{block "holdings-balance-section" .}}
<section id="holdings-balance-section">
  <h3>Total Balance</h3>
  <p>
    Plotting balance in
    {{template "assets-selection" .}}
  </p>
</section>
{{end}}

{{block "assets-selection" .}}
<select name="symbol" hx-get="/plot" hx-target="#balance-plot" hx-trigger="change, load"
        hx-indicator="#spinner">
  {{range .Assets}}
  {{template "asset-option" .}}
  {{end}}
</select>
<div id="balance-plot" class="chart"></div>
<img  id="spinner" class="htmx-indicator" src="/static/img/spinner.svg"/>
{{end}}

{{block "asset-option" .}}
<option value="{{.Symbol}}">{{.Symbol}}</option>
{{end}}

{{block "balance-plot" .}}
<div id="balance-plot" class="chart">
  <br>
  <br>
  <br>
  Plot of balance in {{.AssetSymbol}}.
  <br>
  Last asset prices are
  <ol>
    {{range .Prices}}
    <li>{{.TimestampUtc}} - {{.ValueUsd}}$</li>
    {{end}}
  </ol>
  <br>
  <br>
  <br>
</div>
{{end}}

{{block "holdings-wallets-section" .}}
<section id="holdings-wallets-section">
  <h3>Wallets</h3>
  <ul id="wallet-list" class="card-list">
    {{range .Wallets}}
    {{template "wallet-info-card" .}}
    {{end}}
    {{template "new-wallet-card" .}}
  </ul>
</section>
{{end}}

{{block "wallet-info-card" .}}
<li id="wallet-info-card" class="card">
  <div class="card-info clickable" hx-get="wallet/{{.Id}}" hx-target="#main-content">
    <div class="card-title">
      {{.Name}}
    </div>
    <div class="card-details">
      {{.ValueUsd}}$
    </div>
  </div>
  <div class="card-edit">
    <span class="clickable" hx-get="/edit-wallet-form/{{.Id}}" hx-target="#dialog" hx-on:click="showModal()">
      edit
    </span>
  </div>
</li>
{{end}}

{{define "new-wallet-card"}}
<li id="new-wallet-card" class="card">
  <div type="button" class="clickable" hx-get="/new-wallet-form" hx-target="#dialog" hx-on:click="showModal()">
    Create New
  </div>
</li>
{{end}}

{{block "wallet-form-create" .}}
<form class="modal-content" hx-post="/wallet" hx-target="#holdings-wallets-section" hx-swap="outerHTML">
  {{template "wallet-form-content" .}}
</form>
{{end}}

{{block "wallet-form-edit" .}}
<form class="modal-content" hx-put="/wallet/{{.Wallet.Id}}" hx-target="#holdings-wallets-section" hx-swap="outerHTML">
  {{template "wallet-form-content" .}}
</form>
{{end}}

{{block "wallet-form-content" .}}
  <table>
    <tr>
      <td>
        <label for="name">Wallet Name:</label>
      </td>
    </tr>
    <tr>
      <td>
        <input type="text" id="name" name="Name" value="{{.Wallet.Name}}">
      </td>
    </tr>
    <tr>
      <td>
        <label for="value">Starting Value:</label>
      </td>
    </tr>
    <tr>
      <td>
        <input type="number" id="value" name="ValueUsd" value="{{.Wallet.ValueUsd}}">
        $  <!-- todo: select asset -->
        <!-- {{template "assets-selection" .}} -->
      </td>
    </tr>
    <tr>
      <td>
        <button type="submit" hx-on:click="hideModal()">Submit</button>
      </td>
      <td>
        <button type="button" hx-on:click="hideModal()">Cancel</button>
      </td>
    </tr>
  </table>
{{end}}
